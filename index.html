<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="text/css" rel="stylesheet" href="css/style.css">
        <script type="text/javascript" src="js/libs/jquery/jquery.js"></script>
        <script>
            var DHTMLSprite = function (params) {
                
                var width = params.width,
                    height = params.height,
                    imagesWidth = params.imagesWidth,
                    $element = params.$drawTarget.append('<div/>').find(':last'),
                    elemStyle = $element[0].style,
                    mathFloor = Math.floor;

                $element.css({
                    position: 'absolute',
                    width: width,
                    height: height,
                    backgroundImage: 'url(' + params.images + ')'
                    });
                    
                var that = {
                    
                    draw: function (x, y) {
                        elemStyle.left = x + 'px';
                        elemStyle.top = y + 'px';
                    },
                    changeImage: function (index) {
                        index *= width;
                        var vOffset = -mathFloor(index / imagesWidth) * height;
                        var hOffset = -index % imagesWidth;
                        elemStyle.backgroundPosition = hOffset + 'px ' + vOffset + 'px';
                    },
                    show: function () {
                        elemStyle.display = 'block';
                    },
                    hide: function () {
                        elemStyle.display = 'none';
                    },
                    destroy: function () {
                        $element.remove();
                    }
                };
                    return that;
                };
                                                
                var bouncySprite = function(params) {
                    
                    var x = params.x,
                        y = params.y,
                        xDir = params.xDir,
                        yDir = params.yDir,
                        maxX = params.maxX,
                        maxY = params.maxY,
                        animIndex = 0,
                        that = DHTMLSprite(params);
                
                    alert('x = ' + x);
                    alert('y = ' + y);
                    alert('xDir = ' + xDir);
                    alert('yDir = ' + yDir);
                    alert('animIndex ' + animIndex);

                
                    that.moveAndDraw = function() {                       
                        x += xDir;
                        y += yDir;
                        animIndex += xDir > 0 ? 1 : -1;
                        animIndex %= 6;
                        animIndex += animIndex < 0 ? 5: 0;

                        if ((xDir < 0 && x < 0) || (xDir > 0 && x >= maxX)) {
                                        xDir = -xDir;
                        }
                        if ((yDir < 0 && y < 0) || (yDir > 0 && y >= maxY)) {
                                        yDir = -yDir;
                        }
                        alert("animIndex += xDir > 0 ? 1 : -1; " + animIndex);
                        alert("animIndex %= 4; " + animIndex);
                        alert("animIndex += animIndex < 0 ? 5: 0;" + animIndex);
                        that.changeImage(animIndex);
                        that.draw(x, y);
                    };
                    return that;
                };

                var bouncyBoss = function(numBouncy, $drawTarget) {
                    
                    var bouncys = [];
                   
                    for (var i = 0; i < numBouncy; i++) {
                        bouncys.push(bouncySprite({
                            images: 'img/zombies.png',
                            imagesWidth: 278,
                            width: 46.33333333333333,
                            height: 50,
                            $drawTarget: $drawTarget,
                            x: Math.random() * ($drawTarget.width() - 46.33333333333333),
                            y: Math.random() * ($drawTarget.height() - 50),
                            xDir: Math.random() * 4 - 2,
                            yDir: Math.random() * 4 - 2,
                            maxX: $drawTarget.width() - 46.33333333333333,
                            maxY: $drawTarget.height() - 50
                        }));
                    }
                    var moveAll = function() {											
                        var len = bouncys.length;
                        for (var i = 0; i < len; i++) {
                            bouncys[i].moveAndDraw();
                        }                      					
                        setTimeout(moveAll, 200);
                    };
                    moveAll();
                };
								
                $(document).ready(function() {
                    bouncyBoss(1, $('#zombieLand'));
                });
           
        </script>
    </head>
    <body>
        <div id="zombieLand">
        </div>
    </body>
</html>
