<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="text/css" rel="stylesheet" href="css/style.css">
        <script type="text/javascript" src="js/libs/jquery/jquery.js"></script>
        <script>
            
            var timeInfo = function (goalFPS) {
                var oldTime, paused = true, iterCount = 0, totalFPS = 0;
                
                return  {
                    getInfo: function() {
                        
                        if(paused === true) {
                            paused = false;
                            oldTime = +new Date();
                            
                           return {
                                elapsed: 0,
                                coeff: 0,
                                FPS: 0,
                                averageFPS: 0
                            };
                        }
                        
                        var newTime = +new Date();
                        var elapsed = newTime - oldTime;
                        oldTime = newTime;
                        var FPS = 1000/elapsed;
                            iterCount ++;
                            totalFPS += FPS;
                            
                            return {
                                elapsed: elapsed,
                                coeff: goalFPS / FPS,
                                FPS: FPS,
                                averageFPS: totalFPS / iterCount
                            };
                    },
                    pause: function() {
                        paused = true;
                    }
                };
            };
            
            
            var DHTMLSprite = function (params) {
                
                var width = params.width,
                    height = params.height,
                    imagesWidth = params.imagesWidth,
                    $element = params.$drawTarget.append('<div/>').find(':last'),
                    elemStyle = $element[0].style,
                    mathFloor = Math.floor;

                $element.css({
                    position: 'absolute',
                    width: width,
                    height: height,
                    backgroundImage: 'url(' + params.images + ')'
                    });
                    
                var that = {
                    
                    draw: function (x, y) {
                        elemStyle.left = x + 'px';
                        elemStyle.top = y + 'px';
                    },
                    changeImage: function (index) {
                        index *= width;
                        var vOffset = -mathFloor(index / imagesWidth) * height;
                        var hOffset = -index % imagesWidth;
                        elemStyle.backgroundPosition = hOffset + 'px ' + vOffset + 'px';
                    },
                    show: function () {
                        elemStyle.display = 'block';
                    },
                    hide: function () {
                        elemStyle.display = 'none';
                    },
                    destroy: function () {
                        $element.remove();
                    }
                };
                    return that;
                };
                                                
                var bouncySprite = function(params) {
                    
                    var x = params.x,
                        y = params.y,
                        xDir = params.xDir,
                        maxX = params.maxX,
                        startIndex = params.startIndex,
                        that = DHTMLSprite(params);
                
                    that.moveAndDraw = function() {
                        x += xDir;

                        if ((xDir < 0 && x < 0) || (xDir > 0 && x >= maxX)) {
                            that.destroy();
                        }
                        
                        that.changeImage(startIndex);
                        that.draw(x, y);
                        
//                        switch(startIndex) {
//                            case 4: 
//                                startIndex += 6;
//                                break
//                            case 10: 
//                                startIndex += 6;
//                                break
//                            case 16: 
//                                startIndex = 4;
//                                break
//                        }
                        if(startIndex < 16){
                            startIndex += 6;
                        }else{
                            startIndex = 4;
                        }
                    };
                    return that;
                };

                var bouncyBoss = function(numBouncy, $drawTarget) {
                    
                    var bouncys = [];
                   
                    for (var i = 0; i < numBouncy; i++) {
                        bouncys.push(bouncySprite({
                            images: 'img/zombies.png',
                            imagesWidth: 278,
                            width: 46.33333333333333,
                            height: 49,
                            $drawTarget: $drawTarget,
                            x: 582,
                            y: 158,
                            xDir: -4,
                            maxX: $drawTarget.width() - 46.33333333333333,
                            startIndex: 4
                        }));
                    }
                    var moveAll = function() {											
                        var len = bouncys.length;
                        
                        for (var i = 0; i < len; i++) {
                            bouncys[i].moveAndDraw();
                        }                      					
                        setTimeout(moveAll, 180);
                    };
                    moveAll();
                };
								
                $(document).ready(function() {
                    var createZombie = function() {
                        bouncyBoss(1, $('#zombieLand'));
                        setTimeout(createZombie, 3000);
                    };
                    createZombie();
                });
           
        </script>
    </head>
    <body>
        <div id="zombieLand">
        </div>
    </body>
</html>
